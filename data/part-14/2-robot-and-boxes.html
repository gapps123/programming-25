<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Robot and boxes | programming-25</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Robot and boxes" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://gapps123.github.io/programming-25/programming-25/data/data/part-14/2-robot-and-boxes.html" />
<meta property="og:url" content="https://gapps123.github.io/programming-25/programming-25/data/data/part-14/2-robot-and-boxes.html" />
<meta property="og:site_name" content="programming-25" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Robot and boxes" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Robot and boxes","url":"https://gapps123.github.io/programming-25/programming-25/data/data/part-14/2-robot-and-boxes.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/programming-25/data/assets/css/style.css?v=62b5e7c91b9857657f1df47190c60f9f584810ee">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/programming-25/data/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="https://gapps123.github.io/programming-25/programming-25/data/">programming-25</a></h1>
      

      <p>The most difficult thing to implement in a Sokoban style game tends to be moving the robot so that it can push boxes in the desired direction. The game should be able to tell when the robot can move in a direction specified, and be able to handle any situation where a box should move also. Let’s tackle this challenge now.</p>

<h2 id="handling-key-events">Handling key events</h2>

<p>The player guides the robot with the four arrow keys, so our event handler should also be able to react to the appropriate key events:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">check_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_UP</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_DOWN</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="nb">exit</span><span class="p">()</span>
</code></pre></div></div>

<p>Now whenever the player presses an arrow key, the method <code class="language-plaintext highlighter-rouge">move</code> is called with an appropriate pair of arguments. The first argument contains the movement in the vertical direction, while the second contains the movement in the horizontal direction.</p>

<h2 id="searching-for-the-robot">Searching for the robot</h2>

<p>The game has to know the location of the robot in order to move it correctly. Let’s add the method <code class="language-plaintext highlighter-rouge">find_robot</code> which figures out the location of the robot:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">find_robot</span><span class="p">(</span><span class="bp">self</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">height</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">width</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p>The method goes through all the squares in the game grid and returns the coordinates of the square which contains either the number 4 (the robot on its own) or the number 6 (the robot on a target square).</p>

<p>The idea is that whenever the player presses an arrow key, first the location of the robot is established by going through the squares of the grid. This may seem a bit slow and superfluous, as we could just as well keep the location of the robot in a separate variable or two. The advantage of this search approach is that we are not storing the location of the robot in two different locations (in the game grid <em>and</em> separate variables), but instead we just have to worry about the one location (the game grid), which means that the state of the game in computer memory is simpler to handle.</p>

<h2 id="changes-to-the-game-grid">Changes to the game grid</h2>

<p>We already called the method <code class="language-plaintext highlighter-rouge">move</code> above, but we haven’t actually defined it yet. Let’s do that now.</p>

<p>The <code class="language-plaintext highlighter-rouge">move</code> method takes the direction the player wants to move to as its arguments. It then updates the game grid accordingly, or determines the move is not allowed and leaves the grid unchanged.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move_y</span><span class="p">,</span> <span class="n">move_x</span><span class="p">):</span>
        <span class="n">robot_old_y</span><span class="p">,</span> <span class="n">robot_old_x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find_robot</span><span class="p">()</span> 
        <span class="n">robot_new_y</span> <span class="o">=</span> <span class="n">robot_old_y</span> <span class="o">+</span> <span class="n">move_y</span>
        <span class="n">robot_new_x</span> <span class="o">=</span> <span class="n">robot_old_x</span> <span class="o">+</span> <span class="n">move_x</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
            <span class="n">box_new_y</span> <span class="o">=</span> <span class="n">robot_new_y</span> <span class="o">+</span> <span class="n">move_y</span>
            <span class="n">box_new_x</span> <span class="o">=</span> <span class="n">robot_new_x</span> <span class="o">+</span> <span class="n">move_x</span>

            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">box_new_y</span><span class="p">][</span><span class="n">box_new_x</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">box_new_y</span><span class="p">][</span><span class="n">box_new_x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">3</span>

        <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_old_y</span><span class="p">][</span><span class="n">robot_old_x</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">4</span>
</code></pre></div></div>

<p>The method has quite a lot of different stages, so let’s take a look at each one in turn:</p>

<h3 id="the-old-and-new-location-of-the-robot">The old and new location of the robot</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">robot_old_y</span><span class="p">,</span> <span class="n">robot_old_x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find_robot</span><span class="p">()</span> 
        <span class="n">robot_new_y</span> <span class="o">=</span> <span class="n">robot_old_y</span> <span class="o">+</span> <span class="n">move_y</span>
        <span class="n">robot_new_x</span> <span class="o">=</span> <span class="n">robot_old_x</span> <span class="o">+</span> <span class="n">move_x</span>
</code></pre></div></div>

<p>First, the method calls the <code class="language-plaintext highlighter-rouge">find_robot</code> in order to find the current location of the robot, before the move. This is stored in the variables <code class="language-plaintext highlighter-rouge">robot_old_y</code> and <code class="language-plaintext highlighter-rouge">robot_old_x</code>.</p>

<p>Then the new location of the robot after the prospective move is stored in the variables <code class="language-plaintext highlighter-rouge">robot_new_y</code> and <code class="language-plaintext highlighter-rouge">robot_new_x</code>. The new coordinates can be easily calculated by adding the values passed as arguments to the old location of the robot, as both contained vertical and horizontal values.</p>

<h3 id="did-the-robot-hit-a-wall">Did the robot hit a wall?</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">if</code> statement above takes care of the situation where the robot would hit a wall as a result of the move. Remember, 1 was the position of a wall square in the list of images. This is not allowed, so the method simply returns without any further ado.</p>

<h3 id="moving-a-box">Moving a box</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
            <span class="n">box_new_y</span> <span class="o">=</span> <span class="n">robot_new_y</span> <span class="o">+</span> <span class="n">move_y</span>
            <span class="n">box_new_x</span> <span class="o">=</span> <span class="n">robot_new_x</span> <span class="o">+</span> <span class="n">move_x</span>

            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">box_new_y</span><span class="p">][</span><span class="n">box_new_x</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">box_new_y</span><span class="p">][</span><span class="n">box_new_x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">3</span>
</code></pre></div></div>

<p>If the new prospective location of the robot contains a number 3 (a box on its own) or a number 5 (a box in a target square), the robot attempts to move the box to the next square along. For this purpose we need two new variables: <code class="language-plaintext highlighter-rouge">box_new_y</code> and <code class="language-plaintext highlighter-rouge">box_new_x</code>, which contain the location of the box after the move.</p>

<p>Similarly to the robot, the box cannot be moved to a wall square, with the identifier 1. Neither can the box move onto another box, or a target square with a box on it. If this would happen as a result of the move, the method again simply returns without making any changes to the grid.</p>

<p>In any other case the box can move. The value in the box’s current grid location is decreased by 3, and the value in its new grid location is increased by 3. Because of the clever ordering of the items in the <code class="language-plaintext highlighter-rouge">images</code> list, this works out correctly both when the squares involved are floor squares and target squares.</p>

<h3 id="moving-the-robot">Moving the robot</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_old_y</span><span class="p">][</span><span class="n">robot_old_x</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">4</span>
</code></pre></div></div>

<p>If the execution of the method has reached this point without returning, it is time to move the robot as well. The procedure is similar to moving the box, but the value subtracted from and added to the appropriate locations in the grid is 4 this time around. This ensures, again through the clever ordering of the items in the <code class="language-plaintext highlighter-rouge">images</code> list, that the final result on the grid is correct both when floor and target squares are involved in the move.</p>

<h2 id="refactoring">Refactoring?</h2>

<p>Using only the grid to store the state of the game at all times is very handy in the sense that only one variable is permanently invlved in the whole process, and it is relatively easy to update the state of the grid through simple additions and subtractions.</p>

<p>The downside is that it can be a tad difficult to understand the program code of the game. If someone unfamiliar with the logic used saw this following line of code, they would likely be a bit perplexed:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">box_new_y</span><span class="p">][</span><span class="n">box_new_x</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
</code></pre></div></div>

<p>The code snippet above makes use of <em>magic numbers</em> to represent the squares in the grid. ANyone reading the code would have to know that 1 means wall, 3 means a box and 5 means a box in a target square.</p>

<p>The lines involving the clever subtractions and additions would look even more baffling:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="bp">self</span><span class="p">.</span><span class="nb">map</span><span class="p">[</span><span class="n">robot_new_y</span><span class="p">][</span><span class="n">robot_new_x</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">3</span>
</code></pre></div></div>

<p>The number 3 meant a box just previously, but now it is subtracted from the value of a square on the grid. This works in the context of our numbering scheme, as it changes a box (3) into a normal floor square (0), or a target square with a box (5) into an empty target square (2), but understanding this requiares a primer in the numbering scheme used.</p>

<p>We could make it easier for anyone reading the code by <em>refactoring</em> our implementation. That means improving the structure and readability of the code. One way to achieve this would be to use the names of the squares instead of the numbers 0 to 6, even though this would still not explain how and why numbers can be added and subtracted while maintaining the integrity of the grid.</p>

<p>Making the program code truly accessible would likely require much more fundamentally transformative refactoring. For example, we could keep the structure of the game map in one location, and store the locations of the robot and the boxes in some separate data structure. The downside of <em>this</em> would be that this would likely result in a lot more code, and the internal structure of the game would become much more complicated.</p>

<p>Refactoring and code quality is a subject for some subsequent courses, such as <em>Software Development Methods</em> and <em>Software Engineering</em>.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
